









TÀI LIỆU KẾT NỐI API VIETTELPOST



I. Tổng quan
1.Giới thiệu chung
Hệ thống tích hợp API của Viettel Post là nền tảng kết nối hiện đại, cho phép đối tác và khách hàng dễ dàng tích hợp trực tiếp các dịch vụ logistics của Viettel Post vào hệ thống nội bộ một cách nhanh chóng, đơn giản và bảo mật.
Hệ thống cung cấp 2 môi trường độc lập phục vụ cho việc tích hợp.
●Production : https://partner.viettelpost.vn
●Development : https://partnerdev.viettelpost.vn

Lưu ý:
- Các request mẫu bên dưới đều để dạng Curl, có thể import trực tiếp vào Postman, thay tham số sau đó call API để lấy response mẫu.
- Trường hợp lỗi sẽ response body (application/json) có nội dung. 
- error: true
- message: Nội dung lỗi.
2. Lưu đồ tương tác hệ thống


II. Chi tiết
1.Danh mục địa danh
1.1 Danh mục địa danh (V2)
Danh mục địa danh V2 cung cấp danh mục Tỉnh/TP, Quận/Huyện và Phường/Xã theo cơ cấu hành chính cũ (trước sáp nhập). Đồng thời cũng cung cấp danh mục Tỉnh/TP và Phường/Xã theo cơ cấu hành chính mới (Sau sáp nhập)
1.1.1 Danh mục Tỉnh/TP
Mô tả	API này được sử dụng để lấy danh sách Tỉnh/ TP.
URL	https://partner.viettelpost.vn/v2/categories/listProvinceById?provinceId=-1
Phương thức	GET
Tham số yêu cầu	provinceId (bắt buộc): ID của tỉnh/thành phố muốn tra cứu. 
Có thể  truyền vào pronvinceId = -1 để lấy tất cả Tỉnh/TP
Response mẫu	{
      "PROVINCE_ID": 1,
      "PROVINCE_CODE": "HNI",
      "PROVINCE_NAME": "Hà Nội"
}
Mô tả: 
●PROVINCE_ID: Mã định danh của tỉnh/thành phố trong hệ thống Viettel Post.
●PROVINCE_CODE: Mã tỉnh/thành phố 
●PROVINCE_NAME: Tên đầy đủ của tỉnh/thành phố.

1.1.2 Danh mục Quận/ Huyện:
Mô tả:	API này được sử dụng để lấy danh sách Quận/ Huyện theo Tỉnh/ TP.
URL 	https://partner.viettelpost.vn/v2/categories/listDistrict?provinceId=-1
Phương thức	GET
Tham số yêu cầu	provinceId (bắt buộc): ID của Tỉnh/ TP muốn tra cứu. 
Có thể  truyền vào pronvinceId = -1 để lấy tất cả Quận/ Huyện
Response mẫu	{
    "DISTRICT_ID": 325,
    "DISTRICT_VALUE": "3558",
    "DISTRICT_NAME": "HUYỆN LẠC THỦY",
    "PROVINCE_ID": 31
}
Mô tả:
●DISTRICT_ID: Mã định danh của Quận/ Huyện trong hệ thống Viettel Post.
●DISTRICT_NAME: Tên đầy đủ của Quận/ Huyện
●PROVINCE_ID : Mã định danh của Tỉnh/ TP 


*Cập nhât API Danh mục Quận/Huyện sau sáp nhập.
Đối với 34 Tỉnh/Thành phố sau sáp nhập, trong danh sách Quận/Huyện của mỗi Tỉnh/ TP sẽ xuất hiện thêm một đối tượng có thông tin như sau:

{
"DISTRICT_ID": 100000001, // Tùy thuộc vào Tỉnh/TP
"DISTRICT_VALUE": "NEW",
“DISTRICT_NAME": "Bỏ qua - Sử dụng địa chỉ 2 cấp",
"PROVINCE_ID": 1 // Tùy thuộc vào Tỉnh/TP
}

-Sử dụng DISTRICT_ID của đối tượng này khi gọi API Danh mục Phường/Xã để lấy danh sách Phường/ Xã mới (sau sáp nhập )
-Ngược lại, khi sử dụng DISTRICT_ID của các Quận/ Huyện cũ khi gọi API Danh mục Phường/Xã lấy danh sách Phường/ Xã cũ (trước sáp nhập ).  
1.1.3 Danh mục Phường/ Xã:
Mô tả	API này được sử dụng để lấy danh sách Phường/ Xã ( theo danh mục mới hoặc cũ ) theo Quận/ Huyện.
URL 	https://partner.viettelpost.vn/v2/categories/listWards?districtId=-1
Phương thức	GET
Tham số yêu cầu	districtId (bắt buộc): ID của Quận/ Huyện muốn tra cứu. 
Có thể  truyền vào districtId = -1 để lấy tất cả ID Phường/ Xã
Response mẫu	{
  "WARDS_ID": 405,
  "WARDS_NAME": "PHƯỜNG THẠCH BÀN",
  "DISTRICT_ID": 20
}
Ý nghĩa các trường:
●WARDS_ID: ID của phường/xã.
●WARDS_NAME: Tên của phường/xã.
●DISTRICT_ID: ID Quận/ huyện
1.2. Danh mục địa danh mới (V3) 
Danh mục địa danh mới V3 chỉ cung cấp danh sách Tỉnh/TP và Phường/Xã theo danh mục mới (Sau sáp nhập)
1.2.1 API Lấy danh sách Tỉnh/TP (v3)
Mô tả:	API này được sử dụng để lấy danh sách tất cả các tỉnh/thành phố ( danh mục địa danh mới ) .
URL (Dev)	https://partnerdev.viettelpost.vn/v3/categories/listProvinceNew
Phương thức	GET
Tham số yêu cầu	Không yêu cầu
Response mẫu	{
  "PROVINCE_ID": 1,
  "PROVINCE_CODE": "HNI",
  "PROVINCE_NAME": "Hà Nội"
}
Ý nghĩa các trường:
●PROVINCE_ID: Mã định danh của tỉnh/thành phố trong hệ thống Viettel Post.
●PROVINCE_CODE: Mã viết tắt của tỉnh/thành phố (ví dụ: "HNI" cho Hà Nội).
●PROVINCE_NAME: Tên đầy đủ của tỉnh/thành phố.
1.2.2 API Lấy danh sách Phường/ Xã (v3)
Mô tả	API này được sử dụng để lấy danh sách các phường/xã ( danh mục địa danh mới ) theo tỉnh/thành phố
URL (Dev)	https://partnerdev.viettelpost.vn/v3/categories/listWardsNew?provinceId=1
Phương thức	GET
Tham số yêu cầu	provinceId (bắt buộc): ID của tỉnh/thành phố muốn tra cứu (ví dụ: provinceId=1). Có thể  truyền vào pronvinceId = -1 để lấy tất cả ID phường/xã
Response mẫu	{
  "WARDS_ID": 405,
  "WARDS_NAME": "PHƯỜNG THẠCH BÀN",
  "DISTRICT_ID": 20
}
Ý nghĩa các trường:
●WARDS_ID: ID của phường/xã.
●WARDS_NAME: Tên của phường/xã.
●DISTRICT_ID: ID Quận/ huyện

2. Lấy token
Tài khoản đối tác là tài khoản đại diện kết nối với Viettelpost trong việc truyền và nhận thông tin giữa 2 bên. 
2.1 Lấy token tài khoản đối tác
+ Bước 1: Đăng nhập để lấy token tạm
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/user/Login' \
--header 'Content-Type: application/json' \
--data-raw '{
    "USERNAME":"0933177454",
    "PASSWORD":"xyz@222"
}'
	Trong đó
●USERNAME là tài khoản đăng ký trên https://viettelpost.vn
●PASSWORD là mật khẩu của tài khoản.
- Response mẫu
{
    "status": 200,
    "error": false,
    "message": "OK",
    "data": {
        "userId": 7856551,
        "token": "eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiIwMjE2NDg3ODQxMzYsIlBhcnRuZXIiOjcyMn0.vzaWimV_O16QSatsoB7yz-5oVDRBHKI8ZdJHe2Myy8N0mv1HDSgc5AeaSpfDdL97OUb6rIXQ",
        "partner": 7856551,
        "phone": "0933177454",
        "postcode": null,
        "expired": 0,
        "encrypted": null,
        "source": 5
    }
}
Trong đó: “token“ là, dữ liệu cần lấy.
+ Bước 2: Lấy token dài hạn
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/user/ownerconnect' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiIwMjE2NDg3ODQxMzYsIlBhcnRuZXIiOjcyMn0.vzaWimV_O16QSatsoB7yz-5oVDRBHKI8ZdJHe2Myy8N0mv1HDSgc5AeaSpfDdL97OUb6rIXQ' \
--header 'Content-Type: application/json' \
--header 'Cookie: SERVERID=A' \
--data-raw '{
    "USERNAME":"0933177454",
    "PASSWORD":"xyz@222"
}'

Trong đó: Header Token = token lấy ở bước 1. Tài khoản và mật khẩu tương tự bước 1.
- Response mẫu(application/json)
{
    "status": 200,
    "error": false,
    "message": "OK",
    "data": {
        "userId": 7856551,
        "token": "eyJhbGciOiJFUzI1NiJ9._K2CSZZ9BCIULb0LJdRsr0n7g",
        "partner": 7856551,
        "phone": "0933177454",
        "postcode": null,
        "expired": 0,
        "encrypted": null,
        "source": 5
    }
}

2.2 Lấy token tài khoản client.
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/user/ownerconnect' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiIwMjE2NDg3ODQxMzYsIlBhcnRuZXIiOjcyMn0.vzaWimV_O16QSatsoB7yz-5oVDRBHKI8ZdJHe2Myy8N0mv1HDSgc5AeaSpfDdL97OUb6rIXQ' \
--header 'Content-Type: application/json' \
--header 'Cookie: SERVERID=A' \
--data-raw '{
    "USERNAME":"0933177454",
    "PASSWORD":"xyz@222"
}'


Trong đó: 
●Header Token là token của tài khoản đối tác.
●USERNAME là tài khoản
●PASSWORD là mật khẩu
●Tài khoản, mật khẩu đăng ký trên web https://viettelpost.vn
- Response mẫu
{
    "status": 200,
    "error": false,
    "message": "OK",
    "data": {
        "userId": 7856551,
        "token": "eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiIwOTMzMTc3NDU0IiwiVXNlcklkIjo3ODU2NTUxLCJGcm9tU291cmNlIjo1LCJUb-eB-7c-5sJ2_kDcavzMImejJZXO6ZufQ_BW1r2A8yYqpT6_K2CSZZ9BCIULb0LJdRsr0n7g",
        "partner": 7856551,
        "phone": "0933177454",
        "postcode": null,
        "expired": 0,
        "encrypted": null,
        "source": 5
    }
}

Lưu token trong response để làm Header(Token) tạo đơn và tương tác với đơn hàng trong quá trình vận chuyển.
2.3 Lấy token tài khoản theo tham số bí mật ViettelPost
-Bước 1. Đăng nhập vào website https://viettelpost.vn/ với tài khoản Viettel Post đã được đăng ký trước đó.
-Bước 2. Truy cập vào đường dẫn https://viettelpost.vn/cau-hinh-tai-khoan hoặc thực hiện thao tác như hướng dẫn dưới đây :

2.3.1. Giao diện quản lý token

-Bước 3. Click vào Thêm mới token, hộp thoại xuất hiện yêu cầu người dùng nhập Tên token mong muốn, ví dụ : Viettelpostvn. Sau đó click Xác nhận

2.3.2. Hộp thoại Thêm mới token xuất hiện
-Bước 4. Sau khi tạo thành công, người dùng lựa chọn Sao chép token để có thể lấy token. Hộp thoại xuất hiện xác nhận phương thức xác thực để lấy Token (Email, SMS, Mocha).

2.3.3. Danh sách token đã được tạo


2.3.4. Hộp thoại xác thực OTP xuất hiện



2.3.5. Hộp thoại điền OTP xuất hiện

-Bước 5. Người dùng điền OTP đã nhận được và nhận thông báo sao chép thành công

2.3.6. Thông báo sao chép Token thành công
Lưu token đã sao chép để làm Header(Token) khi sử dụng API Lấy token VTP.
- Request mẫu
curl --location 'https://partner.viettelpost.vn/v2/user/LoginVTP' \
--header 'Content-Type: application/json' \
--data '{
    "token":"58346742179D84F2E9"
}'

Trong đó: 
●Token là token đã lấy từ website https://viettelpost.vn
- Response mẫu
{
    "status": 200,
    "error": false,
    "message": "OK",
    "data": {
        "userId": 8866484,
        "token": "eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiIwMzgyNjc4MDgwIiwiVXNlcklkIjo4ODY2NDg0LCJGcm9tU291cmNlIjo1LC",
        "partner": -1,
        "phone": "0382678080",
        "postcode": null,
        "expired": 1701461935832,
        "encrypted": null,
        "source": 5,
        "infoUpdated": true
    }
}



3. Lấy danh sách dịch vụ phù hợp với hành trình
Quý khách có thể chọn 1 trong 2 cách bên dưới để sử dụng.
3.1Lấy danh sách dịch vụ theo ID địa danh
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/order/getPriceAll' \
--header 'Content-Type: application/json' \
--header 'Token: 31232' \
--header 'Cookie: SERVERID=A' \
--data-raw '{
    "SENDER_DISTRICT": 12,
    "SENDER_PROVINCE": 1,
    "SENDER_WARD": 49876,
    "RECEIVER_DISTRICT": 12,
    "RECEIVER_PROVINCE": 1,
    "RECEIVER_WARD": 49876,
    "PRODUCT_TYPE": "HH",
    "PRODUCT_WEIGHT": 100,
    "PRODUCT_PRICE": 5000000,
    "MONEY_COLLECTION": "5000000",
    "PRODUCT_LENGTH": 0,
    "PRODUCT_WIDTH": 0,
    "PRODUCT_HEIGHT": 0,
    "TYPE": 1
}'

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	Token	Header	String	Token tạo đơn của tài khoản client(Lấy ở mục 1)
2	SENDER_PROVINCE	Body	Long	ID Tỉnh gửi hàng
3	SENDER_DISTRICT	Body	Long	ID Huyện gửi hàng
4	SENDER_WARD	Body	Long	ID Phường/ Xã

5	RECEIVER_PROVINCE	Body	Long 	ID Tỉnh nhận hàng
6	RECEIVER_DISTRICT	Body	Long	ID Huyện nhận hàng
7	RECEIVER_WARD	Body	Long	ID Phường/ Xã


8	PRODUCT_TYPE	Body	String	Loại hàng hóa:
-TH: Thư
-HH: Hàng
9	PRODUCT_WEIGHT	Body	Long	Trọng lượng(Gr)
10	PRODUCT_PRICE	Body	Long 	Giá trị hàng(VNĐ)
11	MONEY_COLLECTION	Body	Long 	Tiền hàng cần thu hộ thu hộ(VNĐ), không bao gồm tiền cước cần thu hộ.
12	TYPE	Body	Long	Loại bảng giá
-0: Bảng giá quốc tế
-1: Bảng giá trong nước
13	PRODUCT_LENGTH	Body	Long	Chiều dài(cm), không bắt buộc
14	PRODUCT_WIDTH	Body	Long	Chiều rộng(cm), không bắt buộc
15	PRODUCT_HEIGHT	Body	Long	Chiều cao(cm), không bắt buộc

- Response mẫu
[
    {
        "MA_DV_CHINH": "PHS",
        "TEN_DICHVU": "Nội tỉnh tiết kiệm",
        "GIA_CUOC": 26400,
        "THOI_GIAN": "48 giờ",
        "EXCHANGE_WEIGHT": 0,
        "EXTRA_SERVICE": [
            {
                "SERVICE_CODE": "GBP",
                "SERVICE_NAME": "Báo phát",
                "DESCRIPTION": null
            },
            {
                "SERVICE_CODE": "XMG",
                "SERVICE_NAME": "Thu tiền xem hàng",
                "DESCRIPTION": null
            }
        ]
    }
]

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	MA_DV_CHINH	Body	String	Mã dịch vụ. Dùng để gán giá trị vào trường ORDER_SERVICE trong API tạo đơn(Mục 4,5).
2	TEN_DICHVU	Body	String	Tên dịch vụ
3	GIA_CUOC	Body	Long	Tổng cước dịch vụ đã bao gồm VAT, không bao gồm phụ phí.
4	THOI_GIAN	Body	String	Thời gian cam kết giao hàng
5	EXCHANGE_WEIGHT	Body	Long	Trọng lượng quy đổi từ kích thước(gr)
6	EXTRA_SERVICE	Body	Object	Danh sách các dịch vụ cộng thêm. Trong đó
-SERVICE_CODE là mã dịch vụ.
-SERVICE_NAME là tên dịch vụ


3.2Lấy danh sách dịch vụ theo địa chỉ chi tiết
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/order/getPriceAllN
lp' \
--header 'Content-Type: application/json' \
--header 'Token: 31232' \
--header 'Cookie: SERVERID=A' \
--data-raw '
{
    "SENDER_ADDRESS": "Đại Mỗ, Nam Từ Liêm, Hà Nội",
    "RECEIVER_ADDRESS": "Định Công, Hoàng Mai, Hà Nội",
    "RECEIVER_PROVINCE": 1,
    "PRODUCT_TYPE": "HH",
    "PRODUCT_WEIGHT": 100,
    "PRODUCT_PRICE": 5000000,
    "MONEY_COLLECTION": "5000000",
    "PRODUCT_LENGTH": 0,
    "PRODUCT_WIDTH": 0,
    "PRODUCT_HEIGHT": 0,
    "TYPE": 1
}'

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	Token	Header	String	Token tạo đơn của tài khoản client(Lấy ở mục 1)
2	SENDER_ADDRESS	Body	String	Địa chỉ người gửi
4	RECEIVER_ADDRESS	Body	String 	Địa chỉ người nhận
6	PRODUCT_TYPE	Body	String	Loại hàng hóa:
-TH: Thư
-HH: Hàng
7	PRODUCT_WEIGHT	Body	Long	Trọng lượng(Gr)
8	PRODUCT_PRICE	Body	Long 	Giá trị hàng(VNĐ)
9	MONEY_COLLECTION	Body	Long 	Tiền hàng cần thu hộ thu hộ(VNĐ), không bao gồm tiền cước cần thu hộ.
10	TYPE	Body	Long	Loại bảng giá
-0: Bảng giá quốc tế
-1: Bảng giá trong nước
11	PRODUCT_LENGTH	Body	Long	Chiều dài(cm), không bắt buộc
12	PRODUCT_WIDTH	Body	Long	Chiều rộng(cm), không bắt buộc
13	PRODUCT_HEIGHT	Body	Long	Chiều cao(cm), không bắt buộc



- Response mẫu
{
    "SENDER_ADDRESS": {
        "PROVINCE_ID": 1,
        "DISTRICT_ID": 25,
        "WARD_ID": 498,
        "ADDRESS": "P.Đại Mỗ - Q.Nam Từ Liêm - TP.Hà Nội"
    },
    "RECEIVER_ADDRESS": {
        "PROVINCE_ID": 1,
        "DISTRICT_ID": 4,
        "WARD_ID": 74,
        "ADDRESS": "P.Định Công - Q.Hoàng Mai - TP.Hà Nội"
    },
    "RESULT": [
        {
            "MA_DV_CHINH": "PHS",
            "TEN_DICHVU": "Nội tỉnh tiết kiệm",
            "GIA_CUOC": 16500,
            "THOI_GIAN": "24 giờ",
            "EXCHANGE_WEIGHT": 0,
            "EXTRA_SERVICE": [
                {
                    "SERVICE_CODE": "GGD",
                    "SERVICE_NAME": "Giao Bưu phẩm tại điểm giao dịch",
                    "DESCRIPTION": null
                },
             ]
        }
    ]
}


Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	SENDER_ADDRESS	Body	Object	Địa chỉ người gửi
Trong đó
-PROVINCE_ID là ID tỉnh, thành phố
-DISTRICT_ID là ID quận, huyện
-WARD_ID là ID phường xã
-ADDRESS là địa chỉ chi tiết format theo VTP

2	RECEIVER_ADDRESS	Body	Object	Địa chỉ người nhận
Trong đó
-PROVINCE_ID là ID tỉnh, thành phố
-DISTRICT_ID là ID quận, huyện
-WARD_ID là ID phường xã
-ADDRESS là địa chỉ chi tiết format theo VTP
3	RESULT	Body	Object	Danh sách dịch vụ
4	MA_DV_CHINH	Body	String	Mã dịch vụ. Dùng để gán giá trị vào trường ORDER_SERVICE trong API tạo đơn(Mục 4,5).
5	TEN_DICHVU	Body	String	Tên dịch vụ
6	GIA_CUOC	Body	Long	Tổng cước dịch vụ đã bao gồm VAT, không bao gồm phụ phí.
7	THOI_GIAN	Body	String	Thời gian cam kết giao hàng
8	EXCHANGE_WEIGHT	Body	Long	Trọng lượng quy đổi từ kích thước(gr)
9	EXTRA_SERVICE	Body	Object	Danh sách các dịch vụ cộng thêm. Trong đó
-SERVICE_CODE là mã dịch vụ.
-SERVICE_NAME là tên dịch vụ



4. Tính cước
Quý khách có thể chọn 1 trong 2 hình thức tính cước bên dưới
  4.1 Tính cước theo ID địa danh
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/order/getPrice' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9.9SrOP1SZVguQA7aRZJ39hIc2TbMq12HigK_Md6Yqcn-HKAgbTPwy-kRas_Oy4y7SGPDmFOdFmBxZOA' \
--header 'Content-Type: application/json' \
--data-raw '{
    "PRODUCT_WEIGHT": 100,
    "PRODUCT_PRICE": 96000,
    "MONEY_COLLECTION": 0,
    "ORDER_SERVICE_ADD": "",
    "ORDER_SERVICE": "VCBO",
    "SENDER_DISTRICT": 12,
    "SENDER_PROVINCE": 1,
    "SENDER_WARD": 49876,
    "RECEIVER_DISTRICT": 12,
    "RECEIVER_PROVINCE": 1,
    "RECEIVER_WARD": 49876,	
    "PRODUCT_LENGTH": 0,
    "PRODUCT_WIDTH": 0, 
    "PRODUCT_HEIGHT": 0,
    "PRODUCT_TYPE": "HH",
    "NATIONAL_TYPE": 1
}'

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	Token	Header	String	Token tạo đơn của tài khoản client(Lấy ở mục 1)
2	SENDER_PROVINCE	Body	Long	ID Tỉnh gửi hàng
3	SENDER_DISTRICT	Body	Long	ID Huyện gửi hàng
4	SENDER_WARD			ID Phường/ Xã
5	RECEIVER_PROVINCE	Body	Long 	ID Tỉnh nhận hàng
6	RECEIVER_DISTRICT	Body	Long	ID Huyện nhận hàng
7	RECEIVER_WARD	Body	Long	ID Phường/ Xã
8	PRODUCT_TYPE	Body	String	Loại hàng hóa:
-TH: Thư
-HH: Hàng
9	PRODUCT_WEIGHT	Body	Long	Trọng lượng(Gr)
10	PRODUCT_PRICE	Body	Long 	Giá trị hàng(VNĐ)
11	MONEY_COLLECTION	Body	Long 	Tiền hàng cần thu hộ thu hộ(VNĐ), không bao gồm tiền cước cần thu hộ.
12	NATIONAL_TYPE	Body	Long	Loại bảng giá
-0: Bảng giá quốc tế
-1: Bảng giá trong nước
13	PRODUCT_LENGTH	Body	Long	Chiều dài(cm), không bắt buộc
14	PRODUCT_WIDTH	Body	Long	Chiều rộng(cm), không bắt buộc
15	PRODUCT_HEIGHT	Body	Long	Chiều cao(cm), không bắt buộc
16	ORDER_SERVICE	Body	String	Mã dịch vụ
17	ORDER_SERVICE_ADD	Body	String	Mã dịch vụ cộng thêm
 
Response mẫu
{
    "status": 200,
    "error": false,
    "message": "OK",
    "data": {
        "MONEY_TOTAL_OLD": 14700,
        "MONEY_TOTAL": 14700,
        "MONEY_TOTAL_FEE": 13363,
        "MONEY_FEE": 0,
        "MONEY_COLLECTION_FEE": 0,
        "MONEY_OTHER_FEE": 0,
        "MONEY_VAS": 0,
        "MONEY_VAT": 1337,
        "KPI_HT": 48.0
    }
}

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	MONEY_TOTAL	Body	Long	Tổng cước
2	MONEY_TOTAL_FEE	Body	Long	Cước dịch vụ chính
3	MONEY_FEE	Body	Long	Phụ phí xăng dầu
4	MONEY_COLLECTION_FEE	Body	Long	Phụ phí thu hộ
5	MONEY_OTHER_FEE	Body	Long	Phụ phí khác
6	MONEY_VAT	Body	Long	Thuế giá trị gia tăng
7	KPI_HT	Body	Double	Tổng thời gian giao hàng cam kết


4.2 Tính cước theo địa chỉ chi tiết
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/order/getPriceNlp' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9.9SrOP1SZVguQA7aRZJ39hIc2TbMq12HigK_Md6Yqcn-HKAgbTPwy-kRas_Oy4y7SGPDmFOdFmBxZOA' \
--header 'Content-Type: application/json' \
--data-raw '{
    "PRODUCT_WEIGHT": 100,
    "PRODUCT_PRICE": 96000,
    "MONEY_COLLECTION": 0,
    "ORDER_SERVICE_ADD": "",
    "ORDER_SERVICE": "VCBO",
    "SENDER_ADDRESS": "Đại Mỗ, Nam Từ Liêm, Hà Nội",
    "RECEIVER_ADDRESS": "Định Công, Hoàng Mai, Hà Nội",
    "PRODUCT_LENGTH": 0,
    "PRODUCT_WIDTH": 0,
    "PRODUCT_HEIGHT": 0,
    "PRODUCT_TYPE": "HH",
    "NATIONAL_TYPE": 1
}'

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	Token	Header	String	Token tạo đơn của tài khoản client(Lấy ở mục 1)
2	SENDER_ADDRESS	Body	String	Địa chỉ người gửi(chỉ bao gồm địa chỉ 3 cấp)
3	RECEIVER_ADDRESS	Body	Long 	Địa chỉ người nhận(chỉ bao gồm địa chỉ 3 cấp)
4	PRODUCT_TYPE	Body	String	Loại hàng hóa:
-TH: Thư
-HH: Hàng
5	PRODUCT_WEIGHT	Body	Long	Trọng lượng(Gr)
6	PRODUCT_PRICE	Body	Long 	Giá trị hàng(VNĐ)
7	MONEY_COLLECTION	Body	Long 	Tiền hàng cần thu hộ thu hộ(VNĐ), không bao gồm tiền cước cần thu hộ.
8	NATIONAL_TYPE	Body	Long	Loại bảng giá
-0: Bảng giá quốc tế
-1: Bảng giá trong nước
9	PRODUCT_LENGTH	Body	Long	Chiều dài(cm), không bắt buộc
10	PRODUCT_WIDTH	Body	Long	Chiều rộng(cm), không bắt buộc
11	PRODUCT_HEIGHT	Body	Long	Chiều cao(cm), không bắt buộc
14	ORDER_SERVICE	Body	String	Mã dịch vụ
15	ORDER_SERVICE_ADD	Body	String	Mã dịch vụ cộng thêm, không bắt buộc
 
Response mẫu
{
    "status": 200,
    "error": false,
    "message": "OK",
    "data": {
        "MONEY_TOTAL_OLD": 16500,
        "MONEY_TOTAL": 16500,
        "MONEY_TOTAL_FEE": 15278,
        "MONEY_FEE": 0,
        "MONEY_COLLECTION_FEE": 0,
        "MONEY_OTHER_FEE": 0,
        "MONEY_VAS": 0,
        "MONEY_VAT": 1222,
        "KPI_HT": 24.0,
        "EXCHANGE_WEIGHT": 0
    }
}

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	MONEY_TOTAL	Body	Long	Tổng cước
2	MONEY_TOTAL_FEE	Body	Long	Cước dịch vụ chính
3	MONEY_FEE	Body	Long	Phụ phí xăng dầu
4	MONEY_COLLECTION_FEE	Body	Long	Phụ phí thu hộ
5	MONEY_OTHER_FEE	Body	Long	Phụ phí khác
6	MONEY_VAT	Body	Long	Thuế giá trị gia tăng
7	KPI_HT	Body	Double	Tổng thời gian giao hàng cam kết
8	EXCHANGE_WEIGHT	Body	Double	Trọng lượng quy đổi, được tính toán dựa trên kích thước 3 chiều của sản phẩm và tỉ lệ quy đổi theo hợp đồng(do nhân viên Kinh doanh của Viettelpost khai báo).



5. Tạo đơn
5.1 Tạo đơn rút gọn
- Request mẫu
curl --location --request POST 'https://partner.viettelpost.vn/v2/order/createOrderNlp' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9.ZzZbZie_3F7_KF9RcwSc0wFFNdRIPSCULsWOcXMp6epVw' \
--header 'Content-Type: application/json' \
--header 'Cookie: SERVERID=A' \
--data-raw '{
            "ORDER_NUMBER": "BM848893946",
            "SENDER_FULLNAME": "Duong An-04",
            "SENDER_ADDRESS": "Số 18, Phường Thạnh Xuân, Quận 12,Hồ Chí Minh",
            "SENDER_PHONE": "09335656565",
            "RECEIVER_FULLNAME": "Nguyễn Văn A",
            "RECEIVER_ADDRESS": "Soso18, Phường Thạnh Xuân, Quận 12,Hồ Chí Minh",
            "RECEIVER_PHONE": "0987654321",
            "PRODUCT_NAME": "Hàng test",
            "PRODUCT_DESCRIPTION": " Cho khách xem hàng khi nhận, cho xem hàng",
            "PRODUCT_QUANTITY": 1,
            "PRODUCT_PRICE": 10000000,
            "PRODUCT_WEIGHT": 10000,
            "PRODUCT_LENGTH": 0,
            "PRODUCT_WIDTH": 0,
            "PRODUCT_HEIGHT": 0,
            "ORDER_PAYMENT": 3,
            "ORDER_SERVICE": "VCN, XMG",
            "PRODUCT_TYPE": "HH",
            "ORDER_SERVICE_ADD": null,
            "ORDER_NOTE": " Cho khách xem hàng khi nhận, cho xem hàng",
            "MONEY_COLLECTION": 56827,  
            "EXTRA_MONEY": 0,  
            "CHECK_UNIQUE": true,  
            "PRODUCT_DETAIL": [
                {
                    "PRODUCT_NAME": "Hàng test",
                    "PRODUCT_QUANTITY": 1,
                    "PRODUCT_PRICE": 10000000,
                    "PRODUCT_WEIGHT": 10000
                }
            ]
        }'

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	Token	Header	String	Token tạo đơn của tài khoản client(Lấy ở mục 1)
2	ORDER_NUMBER	Body	String	Mã đơn hàng
3	SENDER_FULLNAME	Body	String	Tên khách hàng gửi
4	SENDER_PHONE	Body	String	Số điện thoại khách hàng gửi
5	SENDER_ADDRESS	Body	String	Địa chỉ đầy đủ của khách hàng gửi, địa chỉ tối đa 150 byte.
6	RECEIVER_FULLNAME	Body	String	Tên khách hàng nhận
7	RECEIVER_PHONE	Body	String	Số điện thoại khách hàng nhận
8	RECEIVER_ADDRESS	Body	String	Địa chỉ đầy đủ của khách hàng nhận, địa chỉ tối đa 150 byte.
9	PRODUCT_NAME	Body	String	Tên gói hàng
10	PRODUCT_DESCRIPTION	Body	String	Mô tả(Cho xem hàng, thời gian giao, …).
Tối đa 150 byte.
11	PRODUCT_QUANTITY	Body	Long	Tổng số lượng sản phẩm trong gói
12	PRODUCT_PRICE	Body	Long	Tổng giá trị các sản phẩm trong gói
13	PRODUCT_WEIGHT	Body	Long	Tổng trọng lượng các sản phẩm trong gói
14	PRODUCT_LENGTH	Body	Long	Chiều dài(cm), không bắt buộc
15	PRODUCT_WIDTH	Body	Long	Chiều rộng(cm), không bắt buộc
16	PRODUCT_HEIGHT	Body	Long	Chiều cao(cm), không bắt buộc
17	ORDER_PAYMENT	Body	Long	Loại vận đơn
1. Không thu hộ
2. Thu hộ tiền hàng và tiền cước
3. Thu hộ tiền hàng, không thu hộ tiền cước.
4. Thu hộ tiền cước, không thu hộ tiền hàng.
18	ORDER_SERVICE	Body	String	Mã dịch vụ, lấy từ API lấy danh sách dịch vụ phù hợp hoặc tính cước.
19	ORDER_SERVICE_ADD	Body	String	Mã dịch vụ cộng thêm lấy từ API danh sách dịch vụ phù hợp hoặc theo hướng dẫn của nhân viên kinh doanh. Có thể chọn nhiều dịch vụ, mỗi dịch vụ cách nhau bởi dấu phẩy(,).
20	ORDER_NOTE	Body	String	Ghi chú
21	MONEY_COLLECTION	Body	Long	Tiền hàng cần thu hộ
22	PRODUCT_DETAIL	Body	List< Object>	Danh sách hàng hóa chi tiết(Chỉ dùng để đối soát khi có thất thoát).
Danh sách các Object có các thuộc tính như sau:
-PRODUCT_NAME: tên sản phẩm, String.
-PRODUCT_QUANTITY: Số lượng, Long.
-PRODUCT_PRICE: Giá trị, Long.
-PRODUCT_WEIGHT: Trọng lượng, Long.
23	CHECK_UNIQUE	Body	Boolean	Không bắt buộc, giá trị = true/false tương đương với yêu cầu kiểm trùng mã đơn hàng hoặc không.
24	EXTRA_MONEY	Body	Long	Tiền thu khi cho khách xem hàng nhưng không lấy, không vượt quá 2 lần tổng cước. Trường dữ liệu này chỉ có ý nghĩa khi có sử dụng dịch vụ cộng thêm XMG(Xem hàng thu tiền).
25	RETURN_ADDRESS	Body	Object	Thông tin địa chỉ hoàn hàng. Dạng json Object có các thuộc tính như sau:
- REQUIRED: Xác nhận hoàn theo địa chỉ này, kiểu Boolean(true/false).
- FULLADDRESS: Địa chỉ hoàn đầy đủ, kiểu String.
- PROVINCE_ID: ID Tỉnh hoàn về, kiểu Long.
- DISTRICT_ID: ID quận/Huyện hoàn về, kiểu Long.
- WARDS_ID: ID Phường/xã hoàn về, kiểu Long.
Tất cả các trường dữ liệu đều bắt buộc điền. Riêng với các trường String, maxlength mặc định = 100 bytes

Response mẫu
{
    "status": 200,
    "error": false,
    "message": "OK",
    "data": {
        "ORDER_NUMBER": "15878180012",
        "MONEY_COLLECTION": 562000,
        "EXCHANGE_WEIGHT": 50,
        "MONEY_TOTAL": 16500,
        "MONEY_TOTAL_FEE": 15000,
        "MONEY_FEE": 0,
        "MONEY_COLLECTION_FEE": 0,
        "MONEY_OTHER_FEE": 0,
        "MONEY_VAS": 0,
        "MONEY_VAT": 1500,
        "KPI_HT": 48.0,
        "RECEIVER_PROVINCE": 34,
        "RECEIVER_DISTRICT": 390,
        "RECEIVER_WARDS": 7393
    }
}

Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	ORDER_NUMBER	Body	String	Mã vận đơn(Do Viettelpost tự sinh)
2	MONEY_COLLECTION	Body	Long	Tổng tiền thu hộ
3	MONEY_TOTAL	Body	Long	Tổng cước phí
4	MONEY_TOTAL_FEE	Body	Long	Phí vận chuyển
5	MONEY_FEE	Body	Long	Phí xăng dầu
6	MONEY_COLLECTION_FEE	Body	Long	Phí thu hộ
7	MONEY_VAT	Body	Long	Thuế giá trị gia tăng
8	KPI_HT	Body	Double	Thời gian giao hàng cam kết(Tính từ 24 giờ ngày nhận được đơn hàng).
9	EXCHANGE_WEIGHT	Body	Long	Trọng lượng quy đổi
10	RECEIVER_PROVINCE	Body	Long	ID Tỉnh nhận
11	RECEIVER_DISTRICT	Body	Long	ID Huyện nhận
12	RECEIVER_WARDS	Body	Long	ID Phường nhận


5.2 Tạo đơn đầy đủ thông tin
- Url: https://partner.viettelpost.vn/v2/order/createOrder
- Method: POST, header Token
- Body
{
  "ORDER_NUMBER" : "12",
  "GROUPADDRESS_ID" : 5818802,
  "CUS_ID" : 722,
  "DELIVERY_DATE" : "11/10/2018 15:09:52",
  "SENDER_FULLNAME" : "Yanme Shop",
  "SENDER_ADDRESS" : "Số 5A ngách 22 ngõ 282 Kim Giang, Đại Kim, Hoàng Mai, Hà Nội",
  "SENDER_PHONE" : "0967.363.789",
  "SENDER_EMAIL" : "vanchinh.libra@gmail.com",
  "SENDER_WARD" : 25,
  "SENDER_DISTRICT" : 4,
  "SENDER_PROVINCE" : 1,
  "SENDER_LATITUDE" : 0,
  "SENDER_LONGITUDE" : 0,
  "RECEIVER_FULLNAME" : "Hoàng - Test",
  "RECEIVER_ADDRESS" : "1 NKKN P.Nguyễn Thái Bình, Quận 1, TP Hồ Chí Minh",
  "RECEIVER_PHONE" : "0907882792",
  "RECEIVER_EMAIL" : "hoangnh50@fpt.com.vn",
  "RECEIVER_WARD" : 25,
  "RECEIVER_DISTRICT" : 43,
  "RECEIVER_PROVINCE" : 2,
  "RECEIVER_LATITUDE" : 0,
  "RECEIVER_LONGITUDE" : 0,
  "PRODUCT_NAME" : "Máy xay sinh tố Philips HR2118 2.0L ",
  "PRODUCT_DESCRIPTION" : "Máy xay sinh tố Philips HR2118 2.0L ",
  "PRODUCT_QUANTITY" : 1,
  "PRODUCT_PRICE" : 2292764,
  "PRODUCT_WEIGHT" : 40000,
  "PRODUCT_LENGTH" : 38,
  "PRODUCT_WIDTH" : 24,
  "PRODUCT_HEIGHT" : 25,
  "PRODUCT_TYPE" : "HH",
  "ORDER_PAYMENT" : 3,
  "ORDER_SERVICE" : "VCN",
  "ORDER_SERVICE_ADD" : "",
  "ORDER_VOUCHER" : "",
  "ORDER_NOTE" : "cho xem hàng, không cho thử",
  "MONEY_COLLECTION" : 2292764,
  "EXTRA_MONEY" : 0,
  "CHECK_UNIQUE" : true,
  "LIST_ITEM" : [
    {
      "PRODUCT_NAME" : "Máy xay sinh tố Philips HR2118 2.0L ",
      "PRODUCT_PRICE" : 2150000,
      "PRODUCT_WEIGHT" : 2500,
      "PRODUCT_QUANTITY" : 1
    }
  ]
}


Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Vị trí	Kiểu dữ liệu	Mô tả
1	Token	Header	String	Token tạo đơn của tài khoản client(Lấy ở mục 1)
2	ORDER_NUMBER	Body	String	Mã đơn hàng
3	SENDER_FULLNAME	Body	String	Tên khách hàng gửi
4	SENDER_PHONE	Body	String	Số điện thoại khách hàng gửi
5	SENDER_ADDRESS	Body	String	Địa chỉ đầy đủ của khách hàng gửi, địa chỉ tối đa 150 byte.
6	SENDER_PROVINCE	Body	Long	ID Tỉnh gửi.
7	SENDER_DISTRICT	Body	Long	ID Huyện gửi
8	SENDER_WARDS	Body	Long	ID Phường xã gửi hàng
9	RECEIVER_FULLNAME	Body	String	Tên khách hàng nhận
10	RECEIVER_PHONE	Body	String	Số điện thoại khách hàng nhận
11	RECEIVER_ADDRESS	Body	String	Địa chỉ đầy đủ của khách hàng nhận, địa chỉ tối đa 150 byte.
12	RECEIVER_PROVINCE	Body	Long	ID Tỉnh nhận hàng
13	RECEIVER_DISTRICT	Body	Long	ID Huyện nhận hàng
14	RECEIVER_WARDS	Body	Long	ID Phường xã nhận hàng
15	PRODUCT_NAME	Body	String	Tên gói hàng
16	PRODUCT_DESCRIPTION	Body	String	Mô tả(Cho xem hàng, thời gian giao, …), tối đa 150 byte.
17	PRODUCT_QUANTITY	Body	Long	Tổng số lượng sản phẩm trong gói
18	PRODUCT_PRICE	Body	Long	Tổng giá trị các sản phẩm trong gói
19	PRODUCT_WEIGHT	Body	Long	Tổng trọng lượng các sản phẩm trong gói
20	PRODUCT_LENGTH	Body	Long	Chiều dài(cm), không bắt buộc
21	PRODUCT_WIDTH	Body	Long	Chiều rộng(cm), không bắt buộc
22	PRODUCT_HEIGHT	Body	Long	Chiều cao(cm), không bắt buộc
23	ORDER_PAYMENT	Body	Long	Loại vận đơn
1. Không thu hộ
2. Thu hộ tiền hàng và tiền cước
3. Thu hộ tiền hàng
4. Thu hộ tiền cước
24	ORDER_SERVICE	Body	String	Mã dịch vụ, lấy từ API lấy danh sách dịch vụ phù hợp 
25	ORDER_SERVICE_ADD	Body	String	Mã dịch vụ cộng thêm lấy từ API danh sách dịch vụ phù hợp hoặc theo thông báo của nhân viên kinh doanh.
26	ORDER_NOTE	Body	String	Ghi chú
27	MONEY_COLLECTION	Body	Long	Tiền hàng cần thu hộ
28	LIST_ITEM	Body	List<Object>	Danh sách hàng hóa chi tiết(Chỉ dùng để đối soát khi có thất thoát).
List gồm các Object json có tham số như sau:
-PRODUCT_NAME: tên sản phẩm, kiểu String
-PRODUCT_QUANTITY: Số lượng, kiểu Long.
-PRODUCT_PRICE: Giá trị, kiểu Long.
-PRODUCT_WEIGHT: Trọng lượng(gr), kiểu Long.
29	RETURN_ADDRESS	Body	Object	Thông tin địa chỉ hoàn hàng, trong trường hợp địa chỉ hoàn vè là một địa chỉ khác điểm gửi hàng. 
Dạng json Object có các thuộc tính như sau:
- REQUIRED: Xác nhận hoàn theo địa chỉ này, kiểu Boolean(true/false).
- FULLADDRESS: Địa chỉ hoàn đầy đủ, kiểu String.
- PROVINCE_ID: ID Tỉnh hoàn về, kiểu Long.
- DISTRICT_ID: ID quận/Huyện hoàn về, kiểu Long.
- WARDS_ID: ID Phường/xã hoàn về, kiểu Long.
30	GROUPADDRESS_ID	Body	Long	Để = 0
31	CHECK_UNIQUE	Body	Boolean(true/False)	Không bắt buộc. Sử dụng để check trùng Mã đơn hàng.
32	EXTRA_MONEY	Body	Long	Tiền thu khi cho khách xem hàng nhưng không lấy, không vượt quá 2 lần tổng cước. Trường dữ liệu này chỉ có ý nghĩa khi có sử dụng dịch vụ cộng thêm XMG(Xem hàng thu tiền).
 Các trường dữ liệu phía trên đều bắt buộc điền. Riêng đối với các trường dữ liệu kiểu String, maxlength mặc định là 150 bytes.

Response: Giống với request Tạo đơn(4).

6. Cập nhật thông tin đơn hàng
- Url: https://partner.viettelpost.vn/v2/order/edit    
- Method: POST
- Curl mẫu:
curl --location 'https://partnerdev.viettelpost.vn/v2/order/edit' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiIwMzM4MDgyODExIiwiVXNlcklkIjo3NjU3MTQ5LCJGcm9tU291cmNlIjo1LCJUb2tlbiI6IkpZSFIwMFo1QzQiLCJleHAiOjE4MTIzMzQwNDgsIlBhcnRuZXIiOjc2NTcxNDl9.zwcI6uQdf4ly1yWaeR_q0s9pNesDg1BxdpyP09PjceYTWwY6xLBgfHh2zbxexsCMZ4Lxf1jg7ZYQoe4fbx6OpA' \
--header 'Content-Type: application/json' \
--data-raw '{
    "ORDER_NUMBER": "28936127423",
    "GROUPADDRESS_ID": "",
    "CUS_ID": "",
    "DELIVERY_DATE": "26/06/2024 15:09:52",
    "SENDER_FULLNAME": "NGUYEN VAN A",
    "SENDER_ADDRESS": "SỐ 15 DUY TÂN, DỊCH VỌNG HẬU, CẦU GIẤY, HÀ NỘI",
    "SENDER_PHONE": "0338082811",
    "SENDER_EMAIL": "nguyenvana@gmail.com",
    "RECEIVER_FULLNAME": "Linh Nguyen",
    "RECEIVER_ADDRESS": "SỐ 1 Ô CHỢ DỪA, ĐỐNG ĐA, HÀ NỘI",
    "RECEIVER_PHONE": "0338082811",
    "RECEIVER_EMAIL": "linhlinh@mail.com.vn",
    "PRODUCT_NAME": "Máy xay sinh tố Philips HR2118 2.0L",
    "PRODUCT_DESCRIPTION": "Máy xay sinh tố Philips HR2118 2.0L",
    "PRODUCT_QUANTITY": 1,
    "PRODUCT_PRICE": 0,
    "PRODUCT_WEIGHT": 500,
    "PRODUCT_LENGTH": 38,
    "PRODUCT_WIDTH": 24,
    "PRODUCT_HEIGHT": 25,
    "PRODUCT_TYPE": "HH",
    "ORDER_PAYMENT": 3,
    "ORDER_SERVICE": "VCN",
    "ORDER_SERVICE_ADD": "",
    "ORDER_VOUCHER": "",
    "ORDER_NOTE": "Không cho xem hàng",
    "MONEY_COLLECTION": 21500,
    "EXTRA_MONEY”: 0,
    "CHECK_UNIQUE": true,
    "LIST_ITEM": [
        {
            "PRODUCT_NAME": "Tên hàng hóa 1",
            "PRODUCT_PRICE": 210000,
            "PRODUCT_WEIGHT": 250,
            "PRODUCT_QUANTITY": 1
        }
}'

- Request và response giống với API tạo đơn (5), tuy nhiên đơn hàng chỉ được sửa khi trạng thái(ORDER_STATUS) < 200.


7. Webhook
7.1 Thông tin chung
Webhook là một cơ chế callback do hệ thống Viettel Post cung cấp, cho phép gửi dữ liệu tự động đến URL do đối tác cấu hình trước. Mỗi khi đơn hàng có sự thay đổi trạng thái (ví dụ: đã lấy hàng, đang giao, giao thành công, thất bại, hoàn hàng…), hệ thống sẽ gửi một HTTP POST request chứa thông tin cập nhật về đơn hàng đến endpoint Webhook của đối tác.
Flow webhook của Viettelpost:

Lưu ý:
-Mỗi đối tác chỉ được duyệt 1 webhook về tài khoản đối tác. Các tài khoản tạo đơn (client) không cần cấu hình webhook.
-Hành trình sẽ được Viettelpost đẩy tuần tự, mỗi hành trình sẽ được đẩy cho tới khi thành công (Nhận được response status 200) thì mới đẩy hành trình tiếp theo.
-Hành trình có thể bị trùng hoặc thừa (do nghiệp vụ, logic xử lý trên hệ thống core của Viettelpost). 
-Cần trả lại trạng thái (HTTP status) 200 để bypass các trường hợp này. 
-Đối với trường hợp hành trình nhận được nhưng đơn chưa đẩy sang VTP thành công, trường hợp này có thể xảy ra khi tạo đơn bị lỗi mạng, exception trong quá trình lưu dữ liệu. Đối tác xem xét cập nhật lại trên hệ thống trạng thái đơn hàng theo nội dung VTP đẩy sang.
-Các trạng thái kết thúc: Khi đơn hàng phát sình một trong các trạng thái này nó sẽ không phát sinh thêm bất cứ trạng thái nào nữa, đồng nghĩa với việc dừng cập nhật hành trình 
o101 ViettelPost hủy đơn hàng
o107 / -15  Đối tác yêu cầu hủy 
o201 Hủy nhập phiếu gửi 
o501 Thành công - Phát thành công
o503 Hủy - Theo yêu cầu khách hàng (Đơn hàng hoàn)
o504 Thành công - Chuyển trả người gửi (Đơn hàng hoàn)

-Webhook trả về link ảnh gạch báo phát. Ảnh có định dạng .jpg và có thời hạn lưu trữ là 6 tháng. Trong các gói Webhook cơ bản chưa thiết lập mặc định trả về link ảnh báo phát, vì thế đối tác nếu muốn nhận link ảnh qua webhook cần báo lại với Viettel Post.
Link ảnh ở môi trường Development	Link ảnh ở môi trường Production
s3user10106.s3.cloudstorage.com.vn	cloudstorage.com.vn




 Request webhook mẫu
-Method: POST
-Header: Token => Value = Secret Parameter cấu hình trên web.
-Format: Raw, application/json
-Dữ liệu
{
    "DATA": {
        "ORDER_NUMBER": "123456789",
        "ORDER_REFERENCE": "DH13",
        "ORDER_STATUSDATE": "09/03/2022 18:18:08",
        "ORDER_STATUS": 200,
        "STATUS_NAME": "Nhận từ bưu tá - Bưu cục gốc",
        "LOCALION_CURRENTLY": "HCM, BTH, Bình Thạnh - Hồ Chí Minh, 0123456789, 717014, PHƯỜNG 26",
        "NOTE": "[WEB/APP] Nhập doanh thu - TMĐTv2.0",
        "MONEY_COLLECTION": 0,
        "MONEY_FEECOD": 0,
        "MONEY_TOTALFEE": 11818,
        "MONEY_TOTAL": 13000,
        "EXPECTED_DELIVERY": "Khoảng 1 ngày làm việc",
        "PRODUCT_WEIGHT": 110,
        "ORDER_SERVICE": "VCN",
        "ORDER_PAYMENT": 1,
        "EXPECTED_DELIVERY_DATE": "10/03/2022 12:00:00",
        "DETAIL": [
            {
                "CODE": "GNG",
                "VALUE": 0
            }
        ],
        "VOUCHER_VALUE": 0,
        "MONEY_COLLECTION_ORIGIN": 0,
        "EMPLOYEE_NAME": "Mai Thanh Huỳnh",
        "EMPLOYEE_PHONE": "84123456789",
        "IS_RETURNING": false
    },
    "TOKEN": "2fce15e3a456"
}

Lưu ý: MONEY_COLLECTION_ORIGIN tại trước trạng thái 200(Nhập doanh thu) luôn có giá trị null => Không dùng giá trị này.
Trong đó, các trường dữ liệu được mô tả như sau
STT	Tên trường	Kiểu dữ liệu	Mô tả
1	ORDER_NUMBER	String	Mã vận đơn
2	ORDER_REFERENCE	String	Mã tham chiếu(Mã đơn hàng của khách hàng)
3	ORDER_STATUSDATE	String	Ngày trạng thái(format dd/MM/yyyy hh24:mm:ss)
4	ORDER_STATUS	Integer	Trạng thái
5	STATUS_NAME	String	Tên trạng thái
6	LOCALION_CURRENTLY	String	Vị trí hiện tại
7	NOTE	String	Ghi chú
8	MONEY_COLLECTION	Long	Tổng tiền cần thu hộ
9	MONEY_TOTAL	Long	Tổng cước
10	PRODUCT_WEIGHT	Long	Trọng lượng
11	MONEY_COLLECTION_ORIGIN	Long	Tiền hàng cần thu hộ, bắt đầu có giá trị từ trạng thái 200.
12	EMPLOYEE_NAME	String	Tên nhân viên Viettel Post đang cầm hàng.
13	EMPLOYEE_PHONE	String	Số điện thoại nhân viên Viettel Post đang cầm hàng.
14	VOUCHER_VALUE	Long	Giá trị voucher.
15	EXPECTED_DELIVERY_DATE	String	Ngày giao hàng dự kiến. Format dd/MM/yyyy hh24:mm:ss
16	MONEY_FEECOD	Long	Phụ phí thu hộ.
17	ORDER_PAYMENT	Long	Loại vận đơn(Kiểu thanh toán).
18	EXPECTED_DELIVERY	String	Ngày giao hàng dự kiến.
19	ORDER_SERVICE	String	Mã dịch vụ chính.
20	MONEY_TOTALFEE	Long	Cước dịch vụ chính.
21	DETAIL	List<Object>	Chi tiết các dịch vụ cộng thêm. List object có các tham số sau:
- CODE: Mã, String
- VALUE: Giá trị, String/Number.
22	IS_RETURNING	Boolean	Trạng thái cho hàng hoàn, có 2 giá trị:
-True: Đang chuyển hoàn
-False: Đang chuyển đi
Trạng thái này sẽ sai với trường hợp bill đã chuyển hoàn nhưng vì lý do gì đó mà bưu cục hủy tồn để phát lại.
23	REASON_CODE	String	Lý do giao hàng thất bại

7.2 Hướng dẫn tích hợp webhook
B1: Truy cập hệ thống partner 
●Production : https://partner.viettelpost.vn
●Development: https://partnerdev.viettelpost.vn
B2: Thực hiện cấu hình webhook tại mục Cấu hình tài khoản (Account configuration)
>> Thông tin nhận hành trình (Information to receive journey)
B3: Hoàn thành Checklist Go-live (mục 9.3). Trên môi trường Development có thể bỏ qua bước này.
Lưu ý: Đối tác điền đầy đủ thông tin trong Checklist Go-live (đặc biệt là mục số 10 liên quan đến Webhook).
B4: Gửi checklist và thông báo đội hỗ trợ của Viettel Post để duyệt cấu hình Webhook.
Sau khi được ViettelPost duyệt webhook, đối tác có thể kiểm tra việc kết nối bằng cách tạo đơn sau đó hủy đơn, khi này hành trình đơn hàng sẽ được trả về.



8. Luồng chuyển trạng thái đơn hàng
Luồng chuyển trạng thái


Các trạng thái màu vàng, đối tác có thể yêu cầu hủy đơn hàng để chuyển trạng thái Đối tác yêu cầu hủy qua API.


Bảng danh sách trạng thái
Mã	Tên	Mô tả
101	ViettelPost yêu cầu hủy đơn hàng	ViettelPost yêu cầu hủy đơn hàng
102	Đơn hàng chờ xử lý	Thu hàng thất bại. Đơn hàng chờ xử lý
103	Giao cho bưu cục	Viettelpost xử lý đơn hàng
104	Giao cho Bưu tá đi nhận	Giao cho Bưu tá đi nhận
105	Bưu Tá đã nhận hàng	Bưu Tá đã nhận hàng
107	Đối tác yêu cầu hủy qua API	Đối tác yêu cầu hủy qua API
200	Nhận từ bưu tá - Bưu cục gốc	Nhập doanh thu từ Bưu cục
201	Hủy nhập phiếu gửi	Hủy nhập phiếu gửi
202	Sửa phiếu gửi	Sửa phiếu gửi
300	Khai thác đi	Vận chuyển đi từ
400	Khai thác đến	Vận chuyển đến
500	Giao bưu tá đi phát	Phân công bưu tá đi giao hàng
501	Phát thành công	Thành công - Phát thành công
502	Chuyển hoàn bưu cục gốc	Chuyển hoàn bưu cục gốc
503	Hủy - Theo yêu cầu khách hàng	Hủy - Theo yêu cầu khách hàng
504	Hoàn thành công - Chuyển trả người gửi	Thành công - Chuyển hoàn lại cho người gửi
505	Tồn - Thông báo chuyển hoàn bưu cục gốc	Phát thất bại - Thông báo chuyển hoàn bưu cục gốc/ Sai thông tin người nhận/ Không liên hệ được KH/ KH từ chối nhận
506	Tồn - Khách hàng nghỉ, không có nhà	Phát thất bại - Khách hàng nghỉ, không có nhà/ Không nghe máy/ Hẹn giao lại
507	Tồn - Khách hàng đến bưu cục nhận 	Phát thất bại - Khách hàng đến bưu cục nhận 
508	Phát tiếp	Đơn vị yêu cầu phát tiếp
509	Chuyển tiếp bưu cục khác 	Chuyển tiếp bưu cục khác 
515	Duyệt hoàn	Bưu cục phát duyệt hoàn
550	Phát tiếp	Khách hàng yêu cầu phát tiếp

Bảng lý do giao hàng thất bại
NHÓM	MÃ TRẠNG THÁI	LÝ DO CẤP 1	MÃ LÝ DO	LÝ DO CẤP 2
Phát thất bại	506	Người nhận hẹn phát lại		
		Không liên lạc được khách hàng nhận		
		Người nhận không có nhà		
Khách hàng đến bưu cục nhận	507	Khách hàng nhận đến bưu cục nhận	38	 
Thông báo chuyển hoàn	505	Khách từ chối nhận	20	Sai màu sắc
			21	Sai kích thước
			22	Sai kiểu dáng
			23	Chất lượng kém
			24	Không cho xem hàng
			30	Lý do khác
		Sai số điện thoại người nhận	27	 
		Không liên lạc được khách hàng nhiều lần	28	 

9. Mở rộng
9.1 Cập nhật trạng thái vận đơn
Url: https://partner.viettelpost.vn/v2/order/UpdateOrder
Method: POST
Mẫu curl request:
curl --location 'https://partner.viettelpost.vn/v2/order/UpdateOrder' \
--header 'accept: */*' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9 \
--header 'Content-Type: application/json' \
--header 'Cookie: SERVERID=2' \
--data '{
  "TYPE": 4,
  "ORDER_NUMBER": "301298000044",
  "NOTE": "Khách hàng hủy đơn"
}'
Trong đó
- TYPE là loại cập nhật, bao gồm các loại sau
Loại trạng thái:
1. Duyệt đơn hàng
2. Duyệt hoàn, gọi sau khi trạng thái 505 (Thông báo chuyển hoàn) và khách hàng yêu cầu hoàn.
3. Phát tiếp, gọi sau khi trạng thái 505 (Thông báo chuyển hoàn) và khách hàng yêu cầu phát tiếp.
4. Hủy đơn hàng, gọi khi đơn chưa nhận về (trạng thái < 200 và khác 105, 107)
11. Xóa đơn hàng đã hủy, gọi sau khi trạng thái 107 (Hủy đơn hàng).
- ORDER_NUMBER là mã vận đơn cần cập nhật trạng thái
- NOTE là lý do cập nhật trạng thái. Truyền dạng String, không quá 150 ký tự.
 Response mẫu:
{
    "status": 200,
    "error": false,
    "message": "Hủy đơn hàng thành công",
    "data": null
}


9.2 Lấy link in vận đơn
B1. Lấy mã in
Request mẫu:
curl --location 'https://partner.viettelpost.vn/v2/order/printing-code' \
--header 'accept: */*' \
--header 'Token: eyJhbGciOiJFUzI1NiJ9.eyJzdWIiOiIwMzM4MDgyODExIiwiVXNlcklkIjo3' \
--header 'Content-Type: application/json' \
--header 'Cookie: SERVERID=2' \
--data '{
    "EXPIRY_TIME": 1735516800000,
    "ORDER_ARRAY": [
        "301298000044"
    ]
}'
*** Thay thế url = https://partnerdev.viettelpost.vn nếu sử dụng ở môi trường DEV**
Trong đó:
-Token: Là token của tài khoản tạo đơn/Tài khoản partner
-ORDER_ARRAY: Là mảng mã vận đơn của VTP cần tạo link in, tối đa 100 vận đơn
-EXPIRY_TIME: Là thời gian link hết hạn (tương lai), đơn vị epoch in millisecond.
Response mẫu:
{
    "status": 200,
    "error": false,
    "message": "ISJDgZ3NSiYMtPUk7vTzQK8ZWUDexvvDKIclc0NplOU=",
    "data": null
}
Trong đó:
-Message: Là mã code in vận đơn



B2. Thay thế mã code in để lấy link in. Thay thế mã in đã lấy vào link bên dưới, trường ${code}.
*** Thay thế url = https://dev-print.viettelpost.vn nếu sử dụng ở môi trường DEV**
Ví dụ: https://dev-print.viettelpost.vn/DigitalizePrint/report.do?type=1&bill=$ISJDgZ3NSiYMtPUk7vTzQK8ZWUDexvvDKIclc0NplOU=&showPostage=1
Nhãn A5
https://digitalize.viettelpost.vn/DigitalizePrint/report.do?type=1&bill=${code}&showPostage=1
Nhãn A6
https://digitalize.viettelpost.vn/DigitalizePrint/report.do?type=2&bill=${code}&showPostage=1
https://digitalize.viettelpost.vn/DigitalizePrint/report.do?type=a6_1&bill=${code}&showPostage=1
Nhãn A7
https://digitalize.viettelpost.vn/DigitalizePrint/report.do?type=100&bill=${code}&showPostage=1
https://digitalize.viettelpost.vn/DigitalizePrint/report.do?type=1001&bill=${code}&showPostage=1



9.3 Checklist go-live
Khi đã tích hợp xong API, chuẩn bị tới giai đoạn Golive, đối tác vui lòng cập nhật lại checklist bên dưới sau đó gửi lại team VTP hỗ trợ tích hợp dạng excel để phục vụ việc kiểm tra và duyệt webhook.
STT	API	Nội dung	Phản hồi	Khuyến nghị
1	Tài khoản	Số điện thoại được đăng ký làm tài khoản đối tác là gì?	Vui lòng điền thông tin vào mục này	Điền số điện thoại
2	Tạo đơn	Khi gọi API tạo đơn nhưng không nhận được thông tin phản hồi(timeout) hệ thống xử lý như thế nào?	Vui lòng điền thông tin vào mục này	Khóa đơn hàng và cập nhật lại trạng thái + mã vận đơn khi nhận webhook.
3	Webhook	API nhận webhook của bạn có được cấu hình domain và cert chuẩn hay không?	Vui lòng điền thông tin vào mục này	Có
4		Thời gian phản hồi của API nhận webhook là bao nhiêu?	Vui lòng điền thông tin vào mục này	<1s. 
Yêu cầu đính kèm request mẫu(dạng curl) vào checklist khi phản hồi.
5		Căn cứ gì để xác định 1 vận đơn đã được tạo thông qua hệ thống của bạn?	Vui lòng điền thông tin vào mục này	Căn cứ vào mã vận đơn và mã đơn hàng.
6		Khi nhận request về hành trình của 1 đơn hàng nhưng chưa có mã vận đơn trên hệ thống thì hệ thống của bạn xử lý như thế nào?	Vui lòng điền thông tin vào mục này	Cập nhật thông tin vận đơn và ghi nhận hành trình.
7		Khi nhận 1 request về hành trình của 1 đơn lạ hệ thống của bạn sẽ xử lý như thế nào?	Vui lòng điền thông tin vào mục này	Ghi log và bypass
8		Khi nhận 1 request của 1 hành trình không đúng thứ tự so với luồng chuyển trạng thái đơn hàng thống của bạn sẽ xử lý như thế nào?	Vui lòng điền thông tin vào mục này	Ghi log và bypass
9		Khi nhận request của 1 hành trình của 1 đơn hàng đã có trạng thái cuối (Trong ưu ý của webhook).	Vui lòng điền thông tin vào mục này	Ghi log và bypass

9.4. Bảng thông báo lỗi  và mô tả

 STT	Thông báo (message)	Mô tả 
1	Header Token is required	Thiếu Token xác thực trong phần header khi gọi API. 
2	Token invalid	Token bị sai hoặc đã hết hạn.
3	Token invalid or expired	Token bị sai hoặc đã hết hạn.
4	Invalid owner account or password!	Sai tài khoản hoặc mật khẩu.
5	Groupaddress is invalid	ID Địa chỉ nhận hàng  không hợp lệ hoặc không tồn tại. 
6	System error	Lỗi phát sinh từ hệ thống backend, không xác định rõ nguyên nhân.
7	Order does not exist	Mã đơn hàng không tồn tại
8	Order status already exists on the system	Trạng thái đơn hàng đã tồn tại
9	Incorrect data: ORDER_SERVICE	Trường dịch vụ vận chuyển không hợp lệ (ví dụ: mã dịch vụ không tồn tại hoặc không áp dụng cho tuyến đường).
10	Incorrect data: ORDER_PAYMENT	Hình thức thanh toán không hợp lệ (ví dụ: truyền sai mã hoặc để trống).
11	Incorrect data: PRODUCT_TYPE	Loại hàng hóa không hợp lệ hoặc không được cấu hình trong hệ thống.
12	Incorrect data: DELIVERY_DATE	Ngày giao hàng không hợp lệ (ví dụ: ngày quá khứ, sai định dạng yyyy-MM-dd).
13	Incorrect data: SENDER_PROVINCE	SENDER_PROVINCE không hợp lệ
14	Incorrect data: SENDER_DISTRICT	 SENDER_DISTRICT không hợp lệ
15	Incorrect data: SENDER_WARD	SENDER_WARD không hợp lệ
16	Incorrect
  data: RECEIVER_PROVINCE 	RECEIVER_PROVINCE  không hợp lệ
17	Incorrect data: RECEIVER_DISTRICT	RECEIVER_DISTRICT không hợp lệ
18	Incorrect
  data: RECEIVER_WARD 	RECEIVER_WARD không hợp lệ
19	Price does not apply to this itinerary!	Lỗi tính không tính được giá do:
- Dịch vụ chính không không khả dụng với user hoặc địa chỉ giao/nhận
- Dịch vụ cộng thêm không phù hợp đi kèm với dịch vụ chính
20	Blocking create order, please check the configuration	Hệ thống chặn việc tạo đơn do cấu hình chưa đúng. Thường do dịch vụ, tuyến đường, địa chỉ hoặc tài khoản chưa được cấu hình hoàn chỉnh.
21	Invalid [SENDER_WARDS], Invalid [RECEIVER_WARDS]	Phường/ Xã người gửi hoặc người nhận không hợp lệ. Có thể sai mã hoặc không thuộc Quận/ Huyện hoặc Tỉnh/TP đã chọn.
22	Invalid [SENDER_ADDRESS], Invalid [RECEIVER_ADDRESS]	Địa chỉ chi tiết không hợp lệ 
23	Invalid [MONEY_COLLECTION]	Giá trị thu hộ (COD) không hợp lệ 
24	Invalid [RECEIVER_WARDS, RECEIVER_DISTRICT, RECEIVER_PROVINCE]	Địa chỉ nhận không hợp lệ.  Có thể: phường/ xã không thuộc quận/huyện, hoặc quận/huyện không thuộc tỉnh/TP.
25	Incorrect data: SENDER_DISTRICT Incorrect data: SENDER_PROVINCE with address old or Incorrect data: SENDER_PROVINCE with address new	Dữ liệu không hợp lệ: Quận/Huyện người gửi hoặc Tỉnh/Thành phố người gửi không đúng định dạng địa chỉ – có thể là địa chỉ cũ (3 cấp) hoặc địa chỉ mới (2 cấp).
26	Incorrect data: RECEIVER_DISTRICT Incorrect data: RECEIVER_PROVINCE with address old or Incorrect data: RECEIVER_PROVINCE with address new	Dữ liệu không hợp lệ: Quận/Huyện người nhận hoặc Tỉnh/Thành phố người nhận không đúng định dạng địa chỉ – có thể là địa chỉ cũ (3 cấp) hoặc địa chỉ mới (2 cấp).
